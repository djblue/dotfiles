#!/bin/bash

root="$HOME/repos/dotfiles"
vim=/usr/bin/vim

parse-args() {
  local found=0
  for arg in $@; do
    local file="$root/src/$(echo $arg | sed -E 's/.*\.(.*)/\1/')"
    if [ -f $file ]; then
      found=1
      printf "$file "
    else
      printf "$arg "
    fi
  done
  return $found
}

args=$(parse-args $@)

if [ "$?" == "1" ]; then
  cd $root
  trap "exit" INT TERM
  trap "kill 0" EXIT
  clojure -Adots > server.log 2>&1 &
  $vim --servername dots $args
else
  $vim $args
fi

